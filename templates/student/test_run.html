{% extends "student/layout.html" %}
{% block student_content %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold mb-0">{{ a.test.title }}</h4>
    <div class="badge bg-danger-subtle text-danger-emphasis px-3 py-2 rounded-3">
      Осталось: <span id="timer">{{ remaining }}</span> сек.
    </div>
  </div>

  <form method="post" action="{{ url_for('student.test_submit', attempt_id=a.id) }}" id="testForm">
    {% for q in questions %}
    <div class="card border-0 shadow-sm rounded-4 mb-3">
      <div class="card-body">
        <div class="fw-semibold mb-2">{{ loop.index }}. {{ q.text }}</div>

        {% if q.qtype in ['single', 'bool'] %}
          {% for opt in q.options %}
          <div class="form-check">
            <input class="form-check-input" type="radio" name="q{{ q.id }}" id="o{{ opt.id }}" value="{{ opt.id }}">
            <label class="form-check-label" for="o{{ opt.id }}">{{ opt.text }}</label>
          </div>
          {% endfor %}
        {% elif q.qtype == 'multi' %}
          {% for opt in q.options %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="q{{ q.id }}" id="o{{ opt.id }}" value="{{ opt.id }}">
            <label class="form-check-label" for="o{{ opt.id }}">{{ opt.text }}</label>
          </div>
          {% endfor %}
        {% elif q.qtype == 'scale' %}
          <input type="range" class="form-range" min="1" max="5" step="1" name="q{{ q.id }}">
          <div class="small text-body-secondary">1 — «совсем не про меня», 5 — «очень про меня»</div>
        {% endif %}
      </div>
    </div>
    {% endfor %}

    <div class="text-end">
      <button class="btn btn-primary">Отправить</button>
    </div>
  </form>
</div>

<script>
  let t = {{ remaining|int }};
  const span = document.getElementById('timer');
  const form = document.getElementById('testForm');
  const tick = () => {
    if (t <= 0) { form.submit(); return; }
    span.textContent = t;
    t -= 1;
    setTimeout(tick, 1000);
  };
  tick();
</script>
{% endblock %}
